# å¤§æ¨¡å‹é…ç½®ç”¨æˆ·åŒ–æ”¹é€ æŒ‡å—

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-14  
> **ç›®æ ‡**: å°†æ‰€æœ‰å¤§æ¨¡å‹APIå¯†é’¥ä»æœåŠ¡å™¨é…ç½®æ”¹ä¸ºç”¨æˆ·è‡ªå·±å¡«å†™

---

## ğŸ“‹ ç›®å½•

1. [æ”¹é€ æ¦‚è¿°](#æ”¹é€ æ¦‚è¿°)
2. [æ”¹é€ æ­¥éª¤](#æ”¹é€ æ­¥éª¤)
3. [æ•°æ®åº“åˆå§‹åŒ–](#æ•°æ®åº“åˆå§‹åŒ–)
4. [åç«¯æ”¹é€ ](#åç«¯æ”¹é€ )
5. [å‰ç«¯æ”¹é€ ](#å‰ç«¯æ”¹é€ )
6. [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
7. [éƒ¨ç½²æ³¨æ„äº‹é¡¹](#éƒ¨ç½²æ³¨æ„äº‹é¡¹)

---

## ğŸ¯ æ”¹é€ æ¦‚è¿°

### å½“å‰çŠ¶æ€

ç›®å‰é¡¹ç›®ä¸­æœ‰ä¸‰ä¸ªå¤§æ¨¡å‹å®¢æˆ·ç«¯ï¼Œéƒ½é€šè¿‡ç¯å¢ƒå˜é‡ä»æœåŠ¡å™¨é…ç½®ä¸­è¯»å–APIå¯†é’¥ï¼š

1. **GLMClient** (æ™ºè°±GLM) - ä½¿ç”¨ `GLM_API_KEY` ç¯å¢ƒå˜é‡
2. **TuziClient** (è§†é¢‘ç”Ÿæˆ) - ä½¿ç”¨ `TUZI_API_KEY` ç¯å¢ƒå˜é‡  
3. **GeminiClient** (å›¾ç‰‡ç”Ÿæˆ) - ä½¿ç”¨ `GEMINI_API_KEY` ç¯å¢ƒå˜é‡

### æ”¹é€ ç›®æ ‡

å°†æ‰€æœ‰å¤§æ¨¡å‹APIå¯†é’¥æ”¹ä¸ºï¼š
- âœ… å­˜å‚¨åœ¨ç”¨æˆ·æ•°æ®åº“è¡¨ä¸­ï¼ˆæ˜æ–‡å­˜å‚¨ï¼‰
- âœ… ç”¨æˆ·é€šè¿‡å‰ç«¯ç•Œé¢è‡ªè¡Œé…ç½®
- âœ… è°ƒç”¨æ—¶ä»ç”¨æˆ·é…ç½®ä¸­è¯»å–ï¼Œè€Œä¸æ˜¯ç¯å¢ƒå˜é‡
- âœ… ç§»é™¤æœåŠ¡å™¨ç¯å¢ƒå˜é‡é…ç½®

---

## ğŸ”§ æ”¹é€ æ­¥éª¤

### æ­¥éª¤æ¦‚è§ˆ

1. **æ•°æ®åº“åˆå§‹åŒ–** - åœ¨åˆå§‹SQLçš„Userè¡¨ä¸­æ·»åŠ APIå¯†é’¥å­—æ®µ
2. **åç«¯æ•°æ®æ¨¡å‹** - æ›´æ–°Useræ¨¡å‹å’ŒPydanticæ¨¡å‹
3. **åç«¯APIæ¥å£** - æ·»åŠ ç”¨æˆ·APIå¯†é’¥ç®¡ç†æ¥å£
4. **åç«¯å®¢æˆ·ç«¯æ”¹é€ ** - ä¿®æ”¹ä¸‰ä¸ªå®¢æˆ·ç«¯ä»ç”¨æˆ·é…ç½®è¯»å–
5. **åç«¯æœåŠ¡å±‚æ”¹é€ ** - ä¿®æ”¹è°ƒç”¨å®¢æˆ·ç«¯çš„æœåŠ¡å±‚ä¼ é€’ç”¨æˆ·ID
6. **å‰ç«¯ç•Œé¢** - æ·»åŠ APIå¯†é’¥é…ç½®é¡µé¢
7. **ç§»é™¤ç¯å¢ƒå˜é‡** - æ¸…ç†Dockeré…ç½®å’Œæ–‡æ¡£ä¸­çš„ç¯å¢ƒå˜é‡

---

## ğŸ“Š æ•°æ®åº“åˆå§‹åŒ–

### ä¿®æ”¹åˆå§‹SQLæ–‡ä»¶

**æ–‡ä»¶**: `backend/infrastructure/database/migrations/001_initial.sql`

åœ¨ `users` è¡¨çš„åˆ›å»ºè¯­å¥ä¸­æ·»åŠ APIå¯†é’¥å­—æ®µï¼š

```sql
-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url TEXT,
    is_active BOOLEAN DEFAULT true,
    -- æ–°å¢ï¼šAPIå¯†é’¥å­—æ®µï¼ˆæ˜æ–‡å­˜å‚¨ï¼‰
    glm_api_key TEXT,
    tuzi_api_key TEXT,
    gemini_api_key TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

**æ³¨æ„**: 
- é¡¹ç›®æ˜¯åˆå§‹éƒ¨ç½²ï¼Œæ•°æ®åº“ä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹åˆå§‹SQLå³å¯
- APIå¯†é’¥ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ï¼Œä¸éœ€è¦åŠ å¯†
- å­—æ®µå…è®¸ä¸ºNULLï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©æ€§é…ç½®

---

## ğŸ”¨ åç«¯æ”¹é€ 

### 1. æ›´æ–°æ•°æ®åº“æ¨¡å‹

**æ–‡ä»¶**: `backend/shared/models/db_models.py`

```python
class User(Base):
    __tablename__ = "users"
    
    # ... ç°æœ‰å­—æ®µ ...
    
    # æ–°å¢ï¼šAPIå¯†é’¥å­—æ®µï¼ˆæ˜æ–‡å­˜å‚¨ï¼‰
    glm_api_key = Column(Text, nullable=True)
    tuzi_api_key = Column(Text, nullable=True)
    gemini_api_key = Column(Text, nullable)
```

### 2. æ›´æ–°Pydanticæ¨¡å‹

**æ–‡ä»¶**: `backend/shared/models/user.py`

```python
from typing import Optional

class UserBase(BaseModel):
    username: str
    email: EmailStr

class UserCreate(UserBase):
    password: str

class UserUpdate(BaseModel):
    """ç”¨æˆ·æ›´æ–°æ¨¡å‹ï¼ˆä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰"""
    username: Optional[str] = None
    avatar_url: Optional[str] = None

class UserAPIKeysUpdate(BaseModel):
    """ç”¨æˆ·APIå¯†é’¥æ›´æ–°æ¨¡å‹"""
    glm_api_key: Optional[str] = None
    tuzi_api_key: Optional[str] = None
    gemini_api_key: Optional[str] = None

class UserResponse(UserBase):
    id: UUID
    avatar: Optional[str] = None
    isActive: bool
    createdAt: datetime
    updatedAt: datetime
    # æ³¨æ„ï¼šå“åº”ä¸­ä¸åŒ…å«APIå¯†é’¥ï¼Œåªè¿”å›æ˜¯å¦å·²é…ç½®
    has_glm_api_key: bool = False
    has_tuzi_api_key: bool = False
    has_gemini_api_key: bool = False
```

### 3. æ›´æ–°UserService

**æ–‡ä»¶**: `backend/services/data_service/src/services/user_service.py`

```python
class UserService:
    def __init__(self, db: Session):
        self.db = db
        self.user_repo = UserRepository(db)
    
    def update_user_api_keys(
        self,
        user_id: UUID,
        glm_api_key: Optional[str] = None,
        tuzi_api_key: Optional[str] = None,
        gemini_api_key: Optional[str] = None
    ) -> Optional[User]:
        """æ›´æ–°ç”¨æˆ·APIå¯†é’¥"""
        update_data = {}
        
        if glm_api_key is not None:
            # ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ¸…ç©ºå¯†é’¥
            update_data["glm_api_key"] = glm_api_key if glm_api_key else None
        
        if tuzi_api_key is not None:
            update_data["tuzi_api_key"] = tuzi_api_key if tuzi_api_key else None
        
        if gemini_api_key is not None:
            update_data["gemini_api_key"] = gemini_api_key if gemini_api_key else None
        
        return self.user_repo.update_user(user_id, **update_data)
    
    def get_user_api_key(self, user_id: UUID, key_type: str) -> Optional[str]:
        """è·å–ç”¨æˆ·APIå¯†é’¥"""
        user = self.user_repo.get_user_by_id(user_id)
        if not user:
            return None
        
        if key_type == "glm":
            return user.glm_api_key
        elif key_type == "tuzi":
            return user.tuzi_api_key
        elif key_type == "gemini":
            return user.gemini_api_key
        
        return None
```

### 4. æ·»åŠ APIæ¥å£

**æ–‡ä»¶**: `backend/services/data_service/src/api/users.py`

```python
from shared.models.user import UserAPIKeysUpdate

@router.put("/{user_id}/api-keys", response_model=dict)
async def update_user_api_keys(
    user_id: UUID,
    api_keys: UserAPIKeysUpdate,
    current_user = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """æ›´æ–°ç”¨æˆ·APIå¯†é’¥"""
    # åªèƒ½æ›´æ–°è‡ªå·±çš„å¯†é’¥
    if str(current_user.id) != str(user_id):
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="æ— æƒä¿®æ”¹å…¶ä»–ç”¨æˆ·ä¿¡æ¯"
        )
    
    service = UserService(db)
    user = service.update_user_api_keys(
        user_id=user_id,
        glm_api_key=api_keys.glm_api_key,
        tuzi_api_key=api_keys.tuzi_api_key,
        gemini_api_key=api_keys.gemini_api_key
    )
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="ç”¨æˆ·ä¸å­˜åœ¨"
        )
    
    return {
        "code": 200,
        "message": "APIå¯†é’¥æ›´æ–°æˆåŠŸ",
        "data": {
            "has_glm_api_key": user.glm_api_key is not None,
            "has_tuzi_api_key": user.tuzi_api_key is not None,
            "has_gemini_api_key": user.gemini_api_key is not None
        }
    }

@router.get("/{user_id}/api-keys/status", response_model=dict)
async def get_user_api_keys_status(
    user_id: UUID,
    current_user = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–ç”¨æˆ·APIå¯†é’¥é…ç½®çŠ¶æ€ï¼ˆä¸è¿”å›å®é™…å¯†é’¥ï¼‰"""
    if str(current_user.id) != str(user_id):
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="æ— æƒè®¿é—®å…¶ä»–ç”¨æˆ·ä¿¡æ¯"
        )
    
    service = UserService(db)
    user = service.get_user(user_id)
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="ç”¨æˆ·ä¸å­˜åœ¨"
        )
    
    return {
        "code": 200,
        "data": {
            "has_glm_api_key": user.glm_api_key is not None,
            "has_tuzi_api_key": user.tuzi_api_key is not None,
            "has_gemini_api_key": user.gemini_api_key is not None
        }
    }
```

### 5. æ”¹é€ GLMClient

**æ–‡ä»¶**: `backend/services/agent_service/src/clients/glm_client.py`

```python
import httpx
from typing import Dict, Any, Optional
import json

class GLMClient:
    """æ™ºè°± GLM API å®¢æˆ·ç«¯"""
    
    def __init__(self, api_key: str):
        """
        åˆå§‹åŒ–å®¢æˆ·ç«¯
        
        Args:
            api_key: ç”¨æˆ·æä¾›çš„GLM APIå¯†é’¥
        """
        if not api_key:
            raise ValueError("GLM APIå¯†é’¥ä¸èƒ½ä¸ºç©º")
        
        self.base_url = "https://open.bigmodel.cn/api/paas/v4"
        self.api_key = api_key
        self.client = httpx.AsyncClient(
            base_url=self.base_url,
            timeout=60.0,
            headers={
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json"
            }
        )
    
    # ... å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜ ...
    
    async def close(self):
        """å…³é—­å®¢æˆ·ç«¯"""
        await self.client.aclose()
```

### 6. æ”¹é€ TuziClient

**æ–‡ä»¶**: `backend/services/media_service/src/clients/tuzi_client.py`

```python
import httpx
from typing import Dict, Any, Optional
import asyncio

class TuziClient:
    """Tuzi API å®¢æˆ·ç«¯ï¼ˆè§†é¢‘ç”Ÿæˆï¼‰"""
    
    def __init__(self, api_key: str):
        """
        åˆå§‹åŒ–å®¢æˆ·ç«¯
        
        Args:
            api_key: ç”¨æˆ·æä¾›çš„Tuzi APIå¯†é’¥
        """
        if not api_key:
            raise ValueError("Tuzi APIå¯†é’¥ä¸èƒ½ä¸ºç©º")
        
        self.base_url = "https://api.ourzhishi.top"
        self.api_key = api_key
        self.client = httpx.AsyncClient(
            base_url=self.base_url,
            timeout=300.0,
            headers={
                "Authorization": f"Bearer {self.api_key}"
            }
        )
    
    # ... å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜ ...
```

### 7. æ”¹é€ GeminiClient

**æ–‡ä»¶**: `backend/services/media_service/src/clients/gemini_client.py`

```python
import httpx
from typing import Dict, Any, Optional, List

class GeminiClient:
    """Gemini API å®¢æˆ·ç«¯ï¼ˆå›¾ç‰‡ç”Ÿæˆï¼‰"""
    
    def __init__(self, api_key: str):
        """
        åˆå§‹åŒ–å®¢æˆ·ç«¯
        
        Args:
            api_key: ç”¨æˆ·æä¾›çš„Gemini APIå¯†é’¥
        """
        if not api_key:
            raise ValueError("Gemini APIå¯†é’¥ä¸èƒ½ä¸ºç©º")
        
        self.base_url = "https://api.ourzhishi.top"
        self.api_key = api_key
        self.client = httpx.AsyncClient(
            base_url=self.base_url,
            timeout=120.0,
            headers={
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json"
            }
        )
    
    # ... å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜ ...
```

### 8. ä¿®æ”¹æœåŠ¡å±‚è°ƒç”¨

éœ€è¦ä¿®æ”¹æ‰€æœ‰è°ƒç”¨è¿™äº›å®¢æˆ·ç«¯çš„åœ°æ–¹ï¼Œä¼ å…¥ç”¨æˆ·IDå¹¶è·å–ç”¨æˆ·çš„APIå¯†é’¥ã€‚

**ç¤ºä¾‹**: `backend/services/agent_service/src/services/screenplay_service.py`

```python
from services.data_service.src.services.user_service import UserService
from services.agent_service.src.clients.glm_client import GLMClient

class ScreenplayService:
    def __init__(self, db: Session):
        self.db = db
        self.user_service = UserService(db)
    
    async def generate_screenplay(
        self,
        user_id: UUID,
        user_prompt: str,
        # ... å…¶ä»–å‚æ•°
    ):
        # è·å–ç”¨æˆ·çš„GLM APIå¯†é’¥
        glm_api_key = self.user_service.get_user_api_key(user_id, "glm")
        if not glm_api_key:
            raise ValueError("ç”¨æˆ·æœªé…ç½®GLM APIå¯†é’¥ï¼Œè¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®")
        
        # ä½¿ç”¨ç”¨æˆ·å¯†é’¥åˆ›å»ºå®¢æˆ·ç«¯
        glm_client = GLMClient(api_key=glm_api_key)
        
        try:
            # è°ƒç”¨ç”Ÿæˆå‰§æœ¬
            result = await glm_client.generate_screenplay(
                user_prompt=user_prompt,
                # ... å…¶ä»–å‚æ•°
            )
            return result
        finally:
            await glm_client.close()
```

**ç±»ä¼¼åœ°ä¿®æ”¹**:
- `backend/services/media_service/src/services/image_service.py` - ä½¿ç”¨GeminiClient
- `backend/services/media_service/src/services/video_service.py` - ä½¿ç”¨TuziClient

---

## ğŸ¨ å‰ç«¯æ”¹é€ 

### 1. æ·»åŠ APIå¯†é’¥é…ç½®é¡µé¢

**æ–‡ä»¶**: `frontend/lib/features/settings/pages/api_keys_settings_page.dart`

```dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import '../../../core/services/api_service.dart';
import '../../../core/models/user.dart';

class APIKeysSettingsPage extends StatefulWidget {
  @override
  _APIKeysSettingsPageState createState() => _APIKeysSettingsPageState();
}

class _APIKeysSettingsPageState extends State<APIKeysSettingsPage> {
  final _formKey = GlobalKey<FormState>();
  final _glmKeyController = TextEditingController();
  final _tuziKeyController = TextEditingController();
  final _geminiKeyController = TextEditingController();
  
  bool _isLoading = false;
  Map<String, bool> _hasKeys = {
    'glm': false,
    'tuzi': false,
    'gemini': false,
  };
  
  @override
  void initState() {
    super.initState();
    _loadKeysStatus();
  }
  
  Future<void> _loadKeysStatus() async {
    // è°ƒç”¨APIè·å–å¯†é’¥é…ç½®çŠ¶æ€
    try {
      final status = await ApiService.instance.getUserAPIKeysStatus();
      setState(() {
        _hasKeys = {
          'glm': status['has_glm_api_key'] ?? false,
          'tuzi': status['has_tuzi_api_key'] ?? false,
          'gemini': status['has_gemini_api_key'] ?? false,
        };
      });
    } catch (e) {
      // å¤„ç†é”™è¯¯
    }
  }
  
  Future<void> _saveKeys() async {
    if (!_formKey.currentState!.validate()) {
      return;
    }
    
    setState(() {
      _isLoading = true;
    });
    
    try {
      await ApiService.instance.updateUserAPIKeys(
        glmApiKey: _glmKeyController.text.isEmpty ? null : _glmKeyController.text,
        tuziApiKey: _tuziKeyController.text.isEmpty ? null : _tuziKeyController.text,
        geminiApiKey: _geminiKeyController.text.isEmpty ? null : _geminiKeyController.text,
      );
      
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('APIå¯†é’¥ä¿å­˜æˆåŠŸ')),
      );
      
      await _loadKeysStatus();
    } catch (e) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('ä¿å­˜å¤±è´¥: ${e.toString()}')),
      );
    } finally {
      setState(() {
        _isLoading = false;
      });
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('APIå¯†é’¥é…ç½®'),
      ),
      body: Form(
        key: _formKey,
        child: ListView(
          padding: EdgeInsets.all(16),
          children: [
            _buildSection(
              title: 'GLM APIå¯†é’¥',
              description: 'ç”¨äºå‰§æœ¬ç”Ÿæˆå’Œå¯¹è¯åŠŸèƒ½',
              controller: _glmKeyController,
              hasKey: _hasKeys['glm']!,
              hintText: _hasKeys['glm']! ? 'å·²é…ç½®ï¼ˆç•™ç©ºä»¥æ¸…ç©ºï¼‰' : 'è¯·è¾“å…¥GLM APIå¯†é’¥',
            ),
            SizedBox(height: 24),
            _buildSection(
              title: 'Tuzi APIå¯†é’¥',
              description: 'ç”¨äºè§†é¢‘ç”ŸæˆåŠŸèƒ½',
              controller: _tuziKeyController,
              hasKey: _hasKeys['tuzi']!,
              hintText: _hasKeys['tuzi']! ? 'å·²é…ç½®ï¼ˆç•™ç©ºä»¥æ¸…ç©ºï¼‰' : 'è¯·è¾“å…¥Tuzi APIå¯†é’¥',
            ),
            SizedBox(height: 24),
            _buildSection(
              title: 'Gemini APIå¯†é’¥',
              description: 'ç”¨äºå›¾ç‰‡ç”ŸæˆåŠŸèƒ½',
              controller: _geminiKeyController,
              hasKey: _hasKeys['gemini']!,
              hintText: _hasKeys['gemini']! ? 'å·²é…ç½®ï¼ˆç•™ç©ºä»¥æ¸…ç©ºï¼‰' : 'è¯·è¾“å…¥Gemini APIå¯†é’¥',
            ),
            SizedBox(height: 32),
            ElevatedButton(
              onPressed: _isLoading ? null : _saveKeys,
              child: _isLoading
                  ? CircularProgressIndicator()
                  : Text('ä¿å­˜'),
            ),
          ],
        ),
      ),
    );
  }
  
  Widget _buildSection({
    required String title,
    required String description,
    required TextEditingController controller,
    required bool hasKey,
    required String hintText,
  }) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          title,
          style: TextStyle(
            fontSize: 18,
            fontWeight: FontWeight.bold,
          ),
        ),
        SizedBox(height: 4),
        Text(
          description,
          style: TextStyle(
            fontSize: 14,
            color: Colors.grey[600],
          ),
        ),
        SizedBox(height: 8),
        TextFormField(
          controller: controller,
          obscureText: true,
          decoration: InputDecoration(
            hintText: hintText,
            border: OutlineInputBorder(),
            suffixIcon: hasKey
                ? Icon(Icons.check_circle, color: Colors.green)
                : Icon(Icons.warning, color: Colors.orange),
          ),
        ),
      ],
    );
  }
  
  @override
  void dispose() {
    _glmKeyController.dispose();
    _tuziKeyController.dispose();
    _geminiKeyController.dispose();
    super.dispose();
  }
}
```

### 2. æ·»åŠ APIæœåŠ¡æ–¹æ³•

**æ–‡ä»¶**: `frontend/lib/core/services/api_service.dart`

```dart
// æ·»åŠ æ–¹æ³•åˆ°ApiServiceç±»

Future<Map<String, bool>> getUserAPIKeysStatus() async {
  final response = await dio.get('/api/v1/users/${currentUserId}/api-keys/status');
  return response.data['data'];
}

Future<void> updateUserAPIKeys({
  String? glmApiKey,
  String? tuziApiKey,
  String? geminiApiKey,
}) async {
  await dio.put(
    '/api/v1/users/${currentUserId}/api-keys',
    data: {
      'glm_api_key': glmApiKey,
      'tuzi_api_key': tuziApiKey,
      'gemini_api_key': geminiApiKey,
    },
  );
}
```

### 3. åœ¨è®¾ç½®é¡µé¢æ·»åŠ å…¥å£

åœ¨è®¾ç½®é¡µé¢æ·»åŠ "APIå¯†é’¥é…ç½®"é€‰é¡¹ï¼Œè·³è½¬åˆ°ä¸Šè¿°é…ç½®é¡µé¢ã€‚

---

## âœ… æµ‹è¯•éªŒè¯

### 1. å•å…ƒæµ‹è¯•

- æµ‹è¯•UserServiceçš„APIå¯†é’¥æ›´æ–°æ–¹æ³•
- æµ‹è¯•å®¢æˆ·ç«¯åˆå§‹åŒ–ï¼ˆæœ‰å¯†é’¥/æ— å¯†é’¥æƒ…å†µï¼‰

### 2. é›†æˆæµ‹è¯•

- æµ‹è¯•ç”¨æˆ·é…ç½®APIå¯†é’¥æµç¨‹
- æµ‹è¯•ä½¿ç”¨ç”¨æˆ·å¯†é’¥è°ƒç”¨å¤§æ¨¡å‹API
- æµ‹è¯•å¯†é’¥ä¸ºç©ºæ—¶çš„é”™è¯¯å¤„ç†

### 3. æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [ ] ç”¨æˆ·å¯ä»¥åœ¨å‰ç«¯é…ç½®APIå¯†é’¥
- [ ] APIå¯†é’¥æ­£ç¡®å­˜å‚¨åˆ°æ•°æ®åº“
- [ ] è°ƒç”¨å¤§æ¨¡å‹æ—¶ä½¿ç”¨ç”¨æˆ·é…ç½®çš„å¯†é’¥
- [ ] ç”¨æˆ·æœªé…ç½®å¯†é’¥æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- [ ] ç”¨æˆ·å¯ä»¥æ¸…ç©ºå·²é…ç½®çš„å¯†é’¥
- [ ] å¯†é’¥é…ç½®çŠ¶æ€æ­£ç¡®æ˜¾ç¤º

---

## ğŸš€ éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 1. ç¯å¢ƒå˜é‡æ¸…ç†

**éœ€è¦ç§»é™¤çš„ç¯å¢ƒå˜é‡**:
- `GLM_API_KEY`
- `TUZI_API_KEY`
- `GEMINI_API_KEY`

**æ³¨æ„**: ä¸å†éœ€è¦ä»»ä½•æ–°çš„ç¯å¢ƒå˜é‡é…ç½®ã€‚

### 2. Dockeré…ç½®æ›´æ–°

**æ–‡ä»¶**: `backend/infrastructure/docker/docker-compose.yml`

```yaml
agent_service:
  environment:
    # ç§»é™¤ GLM_API_KEY
    # ä¸å†éœ€è¦APIå¯†é’¥ç›¸å…³ç¯å¢ƒå˜é‡

media_service:
  environment:
    # ç§»é™¤ TUZI_API_KEY å’Œ GEMINI_API_KEY
    # ä¸å†éœ€è¦APIå¯†é’¥ç›¸å…³ç¯å¢ƒå˜é‡
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

ç”±äºé¡¹ç›®æ˜¯åˆå§‹éƒ¨ç½²ï¼Œæ•°æ®åº“ä¸ºç©ºï¼Œç›´æ¥ä½¿ç”¨ä¿®æ”¹åçš„åˆå§‹SQLæ–‡ä»¶åˆ›å»ºæ•°æ®åº“å³å¯ï¼š

```bash
psql -d directorai -f backend/infrastructure/database/migrations/001_initial.sql
```

### 4. æ–‡æ¡£æ›´æ–°

æ›´æ–°ä»¥ä¸‹æ–‡æ¡£ï¼Œç§»é™¤APIå¯†é’¥é…ç½®è¯´æ˜ï¼š
- `backend/DEVELOPMENT.md`
- `docs/QUICKSTART.md`
- `backend/infrastructure/docker/README.md`
- `.env.example` æ–‡ä»¶

---

## ğŸ“ æ”¹é€ æ£€æŸ¥æ¸…å•

### æ•°æ®åº“å±‚
- [ ] ä¿®æ”¹åˆå§‹SQLæ–‡ä»¶ï¼Œåœ¨usersè¡¨ä¸­æ·»åŠ APIå¯†é’¥å­—æ®µ
- [ ] æ›´æ–°Useræ•°æ®åº“æ¨¡å‹
- [ ] æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–

### åç«¯å±‚
- [ ] æ›´æ–°User Pydanticæ¨¡å‹
- [ ] æ›´æ–°UserServiceæ·»åŠ APIå¯†é’¥ç®¡ç†æ–¹æ³•
- [ ] æ·»åŠ APIå¯†é’¥ç®¡ç†æ¥å£
- [ ] æ”¹é€ GLMClientæ¥å—api_keyå‚æ•°
- [ ] æ”¹é€ TuziClientæ¥å—api_keyå‚æ•°
- [ ] æ”¹é€ GeminiClientæ¥å—api_keyå‚æ•°
- [ ] ä¿®æ”¹æ‰€æœ‰è°ƒç”¨å®¢æˆ·ç«¯çš„åœ°æ–¹ä¼ å…¥ç”¨æˆ·ID
- [ ] æ·»åŠ å¯†é’¥éªŒè¯å’Œé”™è¯¯å¤„ç†

### å‰ç«¯å±‚
- [ ] åˆ›å»ºAPIå¯†é’¥é…ç½®é¡µé¢
- [ ] æ·»åŠ APIæœåŠ¡æ–¹æ³•
- [ ] åœ¨è®¾ç½®é¡µé¢æ·»åŠ å…¥å£
- [ ] æ·»åŠ å¯†é’¥é…ç½®çŠ¶æ€æ˜¾ç¤º
- [ ] æ·»åŠ å‹å¥½çš„é”™è¯¯æç¤º

### éƒ¨ç½²
- [ ] æ›´æ–°Dockeré…ç½®ï¼ˆç§»é™¤APIå¯†é’¥ç¯å¢ƒå˜é‡ï¼‰
- [ ] æ›´æ–°ç¯å¢ƒå˜é‡æ–‡æ¡£
- [ ] ä½¿ç”¨ä¿®æ”¹åçš„åˆå§‹SQLåˆå§‹åŒ–æ•°æ®åº“
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**: APIå¯†é’¥ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç¡®ä¿æ•°æ®åº“è®¿é—®æƒé™ä¸¥æ ¼æ§åˆ¶
2. **é”™è¯¯å¤„ç†**: ç”¨æˆ·æœªé…ç½®å¯†é’¥æ—¶è¦æœ‰æ¸…æ™°çš„æç¤º
3. **ç”¨æˆ·ä½“éªŒ**: é…ç½®ç•Œé¢è¦ç®€å•æ˜“ç”¨ï¼Œæœ‰æ¸…æ™°çš„è¯´æ˜
4. **å¯†é’¥éªŒè¯**: å¯ä»¥åœ¨ä¿å­˜æ—¶éªŒè¯å¯†é’¥æœ‰æ•ˆæ€§ï¼ˆå¯é€‰ï¼‰

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœæ”¹é€ å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **ä»£ç å›æ»š**: æ¢å¤å®¢æˆ·ç«¯ä»ç¯å¢ƒå˜é‡è¯»å–
2. **ç¯å¢ƒå˜é‡æ¢å¤**: é‡æ–°é…ç½®æœåŠ¡å™¨ç¯å¢ƒå˜é‡

ç”±äºæ˜¯åˆå§‹éƒ¨ç½²ï¼Œæ•°æ®åº“ä¸ºç©ºï¼Œä¸éœ€è¦è€ƒè™‘æ•°æ®è¿ç§»é—®é¢˜ã€‚

---

**å®Œæˆæ—¥æœŸ**: _______________  
**è´Ÿè´£äºº**: _______________  
**å®¡æ ¸äºº**: _______________
