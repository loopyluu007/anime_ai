# ğŸš€ å‰ç«¯éƒ¨ç½²æŒ‡å—

> **ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2026-01-13  
> **é€‚ç”¨å¹³å°**: Flutter Web

---

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
2. [æ„å»ºåº”ç”¨](#æ„å»ºåº”ç”¨)
3. [éƒ¨ç½²æ–¹å¼](#éƒ¨ç½²æ–¹å¼)
   - [Nginx éƒ¨ç½²](#nginx-éƒ¨ç½²)
   - [GitHub Pages éƒ¨ç½²](#github-pages-éƒ¨ç½²)
   - [Vercel éƒ¨ç½²](#vercel-éƒ¨ç½²)
   - [Netlify éƒ¨ç½²](#netlify-éƒ¨ç½²)
   - [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
4. [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
5. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. æ£€æŸ¥ Flutter ç¯å¢ƒ

```bash
# æ£€æŸ¥ Flutter ç‰ˆæœ¬ï¼ˆéœ€è¦ >= 3.0.0ï¼‰
flutter --version

# æ£€æŸ¥ Web æ”¯æŒæ˜¯å¦å¯ç”¨
flutter config --enable-web

# æ£€æŸ¥å¯ç”¨è®¾å¤‡
flutter devices
```

### 2. å®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd anime_ai

# è·å–ä¾èµ–
flutter pub get

# ç”Ÿæˆä»£ç ï¼ˆå¦‚æœæœ‰ä»£ç ç”Ÿæˆéœ€æ±‚ï¼‰
flutter pub run build_runner build --delete-conflicting-outputs
```

### 3. é…ç½® API åœ°å€

åœ¨ `lib/core/config/api_config.dart` ä¸­é…ç½®ç”Ÿäº§ç¯å¢ƒçš„ API åœ°å€ï¼š

```dart
class ApiConfig {
  // ç”Ÿäº§ç¯å¢ƒ
  static const String baseUrl = 'https://api.directorai.com/api/v1';
  static const String wsUrl = 'wss://api.directorai.com/ws';
  
  // æˆ–è€…ä»ç¯å¢ƒå˜é‡è¯»å–
  static String get baseUrl => 
    const String.fromEnvironment('API_BASE_URL', 
      defaultValue: 'https://api.directorai.com/api/v1');
}
```

---

## ğŸ—ï¸ æ„å»ºåº”ç”¨

### 1. åŸºç¡€æ„å»º

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
flutter build web --release

# æ„å»ºè¾“å‡ºç›®å½•
# build/web/
```

### 2. æ„å»ºé€‰é¡¹

```bash
# ä½¿ç”¨ CanvasKit æ¸²æŸ“å™¨ï¼ˆæ›´å¥½çš„æ€§èƒ½ï¼Œæ›´å¤§çš„æ–‡ä»¶ï¼‰
flutter build web --release --web-renderer canvaskit

# ä½¿ç”¨ HTML æ¸²æŸ“å™¨ï¼ˆæ›´å°çš„æ–‡ä»¶ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰
flutter build web --release --web-renderer html

# æŒ‡å®šåŸºç¡€ URLï¼ˆç”¨äºéƒ¨ç½²åˆ°å­ç›®å½•ï¼‰
flutter build web --release --base-href /app/

# å¯ç”¨ä»£ç åˆ†å‰²ï¼ˆå‡å°‘åˆå§‹åŠ è½½æ—¶é—´ï¼‰
flutter build web --release --split-debug-info=debug-info/
```

### 3. éªŒè¯æ„å»ºç»“æœ

```bash
# æ£€æŸ¥æ„å»ºè¾“å‡º
ls -la build/web/

# åº”è¯¥åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
# - index.html
# - main.dart.js
# - flutter_service_worker.js
# - assets/
# - icons/
# - manifest.json
```

### 4. æœ¬åœ°æµ‹è¯•æ„å»ºç»“æœ

```bash
# è¿›å…¥æ„å»ºç›®å½•
cd build/web

# ä½¿ç”¨ Python å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
python -m http.server 8080

# æˆ–ä½¿ç”¨ Node.js
npx serve -s . -p 8080

# è®¿é—® http://localhost:8080 æµ‹è¯•
```

---

## ğŸ“¦ éƒ¨ç½²æ–¹å¼

### Nginx éƒ¨ç½²

#### 1. å‡†å¤‡æœåŠ¡å™¨

```bash
# å®‰è£… Nginxï¼ˆUbuntu/Debianï¼‰
sudo apt update
sudo apt install nginx

# å¯åŠ¨ Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 2. ä¸Šä¼ æ„å»ºæ–‡ä»¶

```bash
# å°† build/web ç›®å½•å†…å®¹ä¸Šä¼ åˆ°æœåŠ¡å™¨
# ä¾‹å¦‚ï¼š/var/www/directorai/web

# ä½¿ç”¨ scp
scp -r build/web/* user@server:/var/www/directorai/web/

# æˆ–ä½¿ç”¨ rsync
rsync -avz build/web/ user@server:/var/www/directorai/web/
```

#### 3. é…ç½® Nginx

åˆ›å»º `/etc/nginx/sites-available/directorai`ï¼š

```nginx
server {
    listen 80;
    server_name directorai.com www.directorai.com;
    
    # é‡å®šå‘åˆ° HTTPSï¼ˆå¯é€‰ï¼‰
    # return 301 https://$server_name$request_uri;
    
    root /var/www/directorai/web;
    index index.html;
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript 
               application/x-javascript application/xml+rss 
               application/json application/javascript 
               application/xml application/xhtml+xml 
               image/svg+xml;
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # Service Worker å’Œ manifest ä¸ç¼“å­˜
    location ~* (flutter_service_worker\.js|manifest\.json)$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # SPA è·¯ç”±æ”¯æŒ - æ‰€æœ‰è·¯ç”±éƒ½è¿”å› index.html
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # API ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
    location /api/ {
        proxy_pass http://localhost:8001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # WebSocket ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
    location /ws {
        proxy_pass http://localhost:8001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_read_timeout 86400;
    }
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # é”™è¯¯é¡µé¢
    error_page 404 /index.html;
}
```

#### 4. å¯ç”¨ HTTPSï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d directorai.com -d www.directorai.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

æ›´æ–° Nginx é…ç½®ä»¥æ”¯æŒ HTTPSï¼š

```nginx
server {
    listen 443 ssl http2;
    server_name directorai.com www.directorai.com;
    
    ssl_certificate /etc/letsencrypt/live/directorai.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/directorai.com/privkey.pem;
    
    # SSL é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # ... å…¶ä»–é…ç½®åŒä¸Š
}

server {
    listen 80;
    server_name directorai.com www.directorai.com;
    return 301 https://$server_name$request_uri;
}
```

#### 5. å¯ç”¨ç«™ç‚¹

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/directorai /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx
```

---

### GitHub Pages éƒ¨ç½²

#### 1. é…ç½®æ„å»ºè„šæœ¬

åˆ›å»º `scripts/deploy_gh_pages.sh`ï¼š

```bash
#!/bin/bash

# æ„å»º Web åº”ç”¨
flutter build web --release --base-href /anime_ai/

# è¿›å…¥æ„å»ºç›®å½•
cd build/web

# åˆ›å»º .nojekyll æ–‡ä»¶ï¼ˆé˜²æ­¢ Jekyll å¤„ç†ï¼‰
touch .nojekyll

# åˆå§‹åŒ– Gitï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
if [ ! -d .git ]; then
    git init
    git remote add origin https://github.com/yourusername/anime_ai.git
fi

# æ·»åŠ æ–‡ä»¶
git add .
git commit -m "Deploy to GitHub Pages"

# æ¨é€åˆ° gh-pages åˆ†æ”¯
git push origin HEAD:gh-pages --force

echo "âœ… éƒ¨ç½²å®Œæˆï¼è®¿é—®: https://yourusername.github.io/anime_ai/"
```

#### 2. é…ç½® GitHub Actions

åˆ›å»º `.github/workflows/deploy.yml`ï¼š

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.0.0'
          channel: 'stable'
      
      - name: Get dependencies
        run: flutter pub get
      
      - name: Build web
        run: flutter build web --release --base-href /anime_ai/
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./build/web
```

#### 3. å¯ç”¨ GitHub Pages

1. è¿›å…¥ GitHub ä»“åº“è®¾ç½®
2. æ‰¾åˆ° "Pages" é€‰é¡¹
3. é€‰æ‹© "gh-pages" åˆ†æ”¯ä½œä¸ºæº
4. è®¿é—® `https://yourusername.github.io/anime_ai/`

---

### Vercel éƒ¨ç½²

#### 1. å®‰è£… Vercel CLI

```bash
npm i -g vercel
```

#### 2. åˆ›å»º `vercel.json`

```json
{
  "version": 2,
  "builds": [
    {
      "src": "build/web/**",
      "use": "@vercel/static"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/build/web/$1"
    }
  ],
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

#### 3. åˆ›å»ºæ„å»ºè„šæœ¬

åˆ›å»º `scripts/build_for_vercel.sh`ï¼š

```bash
#!/bin/bash
flutter build web --release
```

#### 4. éƒ¨ç½²

```bash
# ç™»å½• Vercel
vercel login

# éƒ¨ç½²
vercel --prod
```

æˆ–é€šè¿‡ Vercel ç½‘ç«™ï¼š
1. å¯¼å…¥ GitHub ä»“åº“
2. è®¾ç½®æ„å»ºå‘½ä»¤ï¼š`flutter build web --release`
3. è®¾ç½®è¾“å‡ºç›®å½•ï¼š`build/web`
4. éƒ¨ç½²

---

### Netlify éƒ¨ç½²

#### 1. åˆ›å»º `netlify.toml`

```toml
[build]
  command = "flutter build web --release"
  publish = "build/web"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  FLUTTER_VERSION = "3.0.0"
```

#### 2. åˆ›å»ºæ„å»ºè„šæœ¬

åˆ›å»º `scripts/netlify_build.sh`ï¼š

```bash
#!/bin/bash
set -e

# å®‰è£… Flutterï¼ˆå¦‚æœ Netlify æ²¡æœ‰ï¼‰
if ! command -v flutter &> /dev/null; then
    echo "å®‰è£… Flutter..."
    git clone https://github.com/flutter/flutter.git -b stable
    export PATH="$PATH:`pwd`/flutter/bin"
fi

# è·å–ä¾èµ–
flutter pub get

# æ„å»º
flutter build web --release
```

#### 3. éƒ¨ç½²

1. ç™»å½• [Netlify](https://www.netlify.com/)
2. ç‚¹å‡» "New site from Git"
3. é€‰æ‹© GitHub ä»“åº“
4. è®¾ç½®ï¼š
   - Build command: `bash scripts/netlify_build.sh`
   - Publish directory: `build/web`
5. éƒ¨ç½²

---

### Docker éƒ¨ç½²

#### 1. åˆ›å»º `Dockerfile`

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM ubuntu:22.04 AS builder

# å®‰è£…ä¾èµ–
RUN apt-get update && apt-get install -y \
    curl \
    git \
    unzip \
    xz-utils \
    zip \
    libglu1-mesa \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£… Flutter
ENV FLUTTER_VERSION=3.0.0
RUN git clone https://github.com/flutter/flutter.git -b stable /flutter
ENV PATH="/flutter/bin:${PATH}"

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
WORKDIR /app
COPY pubspec.yaml pubspec.lock ./
RUN flutter pub get
COPY . .

# æ„å»º Web åº”ç”¨
RUN flutter build web --release

# è¿è¡Œé˜¶æ®µ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºæ–‡ä»¶
COPY --from=builder /app/build/web /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### 2. åˆ›å»º `nginx.conf`

```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 3. æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºé•œåƒ
docker build -t directorai-web:latest .

# è¿è¡Œå®¹å™¨
docker run -d -p 8080:80 --name directorai-web directorai-web:latest

# è®¿é—® http://localhost:8080
```

#### 4. ä½¿ç”¨ Docker Compose

åˆ›å»º `docker-compose.yml`ï¼š

```yaml
version: '3.8'

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:80"
    restart: unless-stopped
```

è¿è¡Œï¼š

```bash
docker-compose up -d
```

---

## âš™ï¸ ç¯å¢ƒé…ç½®

### 1. ç¯å¢ƒå˜é‡

åˆ›å»º `.env.production`ï¼š

```env
API_BASE_URL=https://api.directorai.com/api/v1
WS_URL=wss://api.directorai.com/ws
DEBUG=false
```

### 2. è¿è¡Œæ—¶é…ç½®

åœ¨ `lib/core/config/app_config.dart` ä¸­ï¼š

```dart
class AppConfig {
  static String get apiBaseUrl {
    if (kIsWeb) {
      // ä» window.location è·å–
      final host = html.window.location.host;
      if (host.contains('localhost')) {
        return 'http://localhost:8001/api/v1';
      }
      return 'https://api.directorai.com/api/v1';
    }
    return const String.fromEnvironment('API_BASE_URL');
  }
}
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. ä»£ç åˆ†å‰²

```bash
flutter build web --release --split-debug-info=debug-info/
```

### 2. èµ„æºä¼˜åŒ–

- å‹ç¼©å›¾ç‰‡
- ä½¿ç”¨ WebP æ ¼å¼
- å¯ç”¨ Gzip/Brotli å‹ç¼©

### 3. ç¼“å­˜ç­–ç•¥

- é™æ€èµ„æºï¼šé•¿æœŸç¼“å­˜ï¼ˆ1å¹´ï¼‰
- HTMLï¼šä¸ç¼“å­˜
- Service Workerï¼šç‰ˆæœ¬æ§åˆ¶

### 4. CDN é…ç½®

å°†é™æ€èµ„æºéƒ¨ç½²åˆ° CDNï¼š

```dart
// åœ¨æ„å»ºæ—¶è®¾ç½® CDN URL
flutter build web --release --dart-define=CDN_URL=https://cdn.directorai.com
```

---

## â“ å¸¸è§é—®é¢˜

### 1. æ„å»ºå¤±è´¥

**é—®é¢˜**: `flutter build web` å¤±è´¥

**è§£å†³**:
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
flutter clean
flutter pub get

# æ£€æŸ¥ Flutter ç‰ˆæœ¬
flutter --version

# æ£€æŸ¥ Web æ”¯æŒ
flutter config --enable-web
```

### 2. è·¯ç”± 404 é”™è¯¯

**é—®é¢˜**: åˆ·æ–°é¡µé¢åå‡ºç° 404

**è§£å†³**: ç¡®ä¿æœåŠ¡å™¨é…ç½®äº† SPA è·¯ç”±æ”¯æŒï¼š
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### 3. API è¯·æ±‚å¤±è´¥ï¼ˆCORSï¼‰

**é—®é¢˜**: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢

**è§£å†³**: åœ¨åç«¯é…ç½® CORS å¤´ï¼š
```python
# FastAPI ç¤ºä¾‹
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://directorai.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 4. Service Worker ä¸æ›´æ–°

**é—®é¢˜**: æ›´æ–°åä»æ˜¾ç¤ºæ—§ç‰ˆæœ¬

**è§£å†³**:
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ£€æŸ¥ `flutter_service_worker.js` ç‰ˆæœ¬å·
- ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®é…ç½®äº† Service Worker çš„ç¼“å­˜ç­–ç•¥

### 5. è§†é¢‘æ— æ³•æ’­æ”¾

**é—®é¢˜**: Web ç«¯è§†é¢‘æ’­æ”¾å¤±è´¥

**è§£å†³**:
- æ£€æŸ¥è§†é¢‘ URL æ˜¯å¦å¯è®¿é—®
- ç¡®è®¤è§†é¢‘æ ¼å¼ï¼ˆWeb ç«¯éœ€è¦ MP4 H.264ï¼‰
- æ£€æŸ¥ CORS é…ç½®
- ä½¿ç”¨ `WebVideoAdapter` é€‚é…å™¨

### 6. æ„å»ºæ–‡ä»¶è¿‡å¤§

**é—®é¢˜**: `main.dart.js` æ–‡ä»¶è¿‡å¤§ï¼ˆ> 5MBï¼‰

**è§£å†³**:
```bash
# ä½¿ç”¨ä»£ç åˆ†å‰²
flutter build web --release --split-debug-info=debug-info/

# ä½¿ç”¨ CanvasKitï¼ˆå¯é€‰ï¼Œä½†æ–‡ä»¶æ›´å¤§ï¼‰
flutter build web --release --web-renderer canvaskit

# æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–
flutter pub deps
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] Flutter ç¯å¢ƒå·²é…ç½®
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆ`flutter pub get`ï¼‰
- [ ] API åœ°å€å·²é…ç½®ä¸ºç”Ÿäº§ç¯å¢ƒ
- [ ] æ„å»ºæˆåŠŸï¼ˆ`flutter build web --release`ï¼‰
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] æœåŠ¡å™¨é…ç½®æ­£ç¡®ï¼ˆNginx/å…¶ä»–ï¼‰
- [ ] HTTPS å·²é…ç½®ï¼ˆæ¨èï¼‰
- [ ] åŸŸå DNS å·²é…ç½®
- [ ] Service Worker æ­£å¸¸å·¥ä½œ
- [ ] PWA åŠŸèƒ½æ­£å¸¸
- [ ] è·¨åŸŸé…ç½®æ­£ç¡®
- [ ] é™æ€èµ„æºç¼“å­˜é…ç½®æ­£ç¡®
- [ ] é”™è¯¯ç›‘æ§å·²é…ç½®ï¼ˆå¯é€‰ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Flutter Web å®˜æ–¹æ–‡æ¡£](https://docs.flutter.dev/platform-integration/web)
- [Nginx å®˜æ–¹æ–‡æ¡£](https://nginx.org/en/docs/)
- [GitHub Pages æ–‡æ¡£](https://docs.github.com/en/pages)
- [Vercel æ–‡æ¡£](https://vercel.com/docs)
- [Netlify æ–‡æ¡£](https://docs.netlify.com/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-13  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
