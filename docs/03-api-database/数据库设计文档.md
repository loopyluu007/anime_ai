# æ•°æ®åº“è®¾è®¡æ–‡æ¡£

> **æ•°æ®åº“**: PostgreSQL 15+  
> **ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åº“æ¦‚è¿°](#æ•°æ®åº“æ¦‚è¿°)
2. [è¡¨ç»“æ„è®¾è®¡](#è¡¨ç»“æ„è®¾è®¡)
3. [ç´¢å¼•è®¾è®¡](#ç´¢å¼•è®¾è®¡)
4. [å…³ç³»å›¾](#å…³ç³»å›¾)
5. [æ•°æ®è¿ç§»](#æ•°æ®è¿ç§»)

---

## ğŸ—„ï¸ æ•°æ®åº“æ¦‚è¿°

### æ•°æ®åº“é€‰æ‹©

- **ä¸»æ•°æ®åº“**: PostgreSQL 15+
- **ç¼“å­˜**: Redis 7+
- **æ–‡ä»¶å­˜å‚¨**: MinIO / AWS S3 / é˜¿é‡Œäº‘ OSS

### å‘½åè§„èŒƒ

- **è¡¨å**: å°å†™ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿ï¼Œå¤æ•°å½¢å¼ï¼ˆå¦‚ `users`, `conversations`ï¼‰
- **å­—æ®µå**: å°å†™ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆå¦‚ `user_id`, `created_at`ï¼‰
- **ç´¢å¼•å**: `idx_{table}_{column}` æˆ– `idx_{table}_{column1}_{column2}`
- **å¤–é”®å**: `fk_{table}_{referenced_table}`

---

## ğŸ“Š è¡¨ç»“æ„è®¾è®¡

### 1. ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
```

**å­—æ®µè¯´æ˜**:
- `id`: ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `username`: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- `email`: é‚®ç®±ï¼ˆå”¯ä¸€ï¼Œç”¨äºç™»å½•ï¼‰
- `password_hash`: å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰
- `avatar_url`: å¤´åƒ URL
- `is_active`: æ˜¯å¦æ¿€æ´»
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### 2. å¯¹è¯è¡¨ (conversations)

```sql
CREATE TABLE conversations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    preview_text TEXT,
    message_count INTEGER DEFAULT 0,
    is_pinned BOOLEAN DEFAULT false,
    last_accessed_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_conversations_user_id ON conversations(user_id);
CREATE INDEX idx_conversations_user_updated ON conversations(user_id, updated_at DESC);
CREATE INDEX idx_conversations_user_pinned ON conversations(user_id, is_pinned DESC, updated_at DESC);
```

**å­—æ®µè¯´æ˜**:
- `id`: å¯¹è¯å”¯ä¸€æ ‡è¯†
- `user_id`: ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰
- `title`: å¯¹è¯æ ‡é¢˜
- `preview_text`: é¢„è§ˆæ–‡æœ¬ï¼ˆæœ€åä¸€æ¡æ¶ˆæ¯çš„æ‘˜è¦ï¼‰
- `message_count`: æ¶ˆæ¯æ•°é‡
- `is_pinned`: æ˜¯å¦ç½®é¡¶
- `last_accessed_at`: æœ€åè®¿é—®æ—¶é—´
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### 3. æ¶ˆæ¯è¡¨ (messages)

```sql
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
    role VARCHAR(20) NOT NULL CHECK (role IN ('user', 'assistant')),
    content TEXT NOT NULL,
    type VARCHAR(20) NOT NULL DEFAULT 'text' CHECK (type IN ('text', 'image', 'video', 'screenplay')),
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_messages_conversation_id ON messages(conversation_id);
CREATE INDEX idx_messages_conversation_created ON messages(conversation_id, created_at);
CREATE INDEX idx_messages_type ON messages(type);
```

**å­—æ®µè¯´æ˜**:
- `id`: æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
- `conversation_id`: å¯¹è¯ IDï¼ˆå¤–é”®ï¼‰
- `role`: è§’è‰²ï¼ˆuser/assistantï¼‰
- `content`: æ¶ˆæ¯å†…å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰
- `type`: æ¶ˆæ¯ç±»å‹ï¼ˆtext/image/video/screenplayï¼‰
- `metadata`: å…ƒæ•°æ®ï¼ˆJSONï¼Œå­˜å‚¨å›¾ç‰‡ URLã€è§†é¢‘ URLã€å‰§æœ¬ ID ç­‰ï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´

**metadata ç¤ºä¾‹**:
```json
{
  "imageUrl": "https://...",
  "videoUrl": "https://...",
  "screenplayId": "uuid"
}
```

### 4. ä»»åŠ¡è¡¨ (tasks)

```sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    conversation_id UUID REFERENCES conversations(id) ON DELETE SET NULL,
    type VARCHAR(50) NOT NULL CHECK (type IN ('screenplay', 'image', 'video')),
    status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'completed', 'failed', 'cancelled')),
    progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
    params JSONB,
    result JSONB,
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_user_status ON tasks(user_id, status);
CREATE INDEX idx_tasks_conversation_id ON tasks(conversation_id);
CREATE INDEX idx_tasks_type ON tasks(type);
CREATE INDEX idx_tasks_status ON tasks(status);
```

**å­—æ®µè¯´æ˜**:
- `id`: ä»»åŠ¡å”¯ä¸€æ ‡è¯†
- `user_id`: ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰
- `conversation_id`: å…³è”å¯¹è¯ IDï¼ˆå¯é€‰ï¼‰
- `type`: ä»»åŠ¡ç±»å‹
- `status`: ä»»åŠ¡çŠ¶æ€
- `progress`: è¿›åº¦ï¼ˆ0-100ï¼‰
- `params`: ä»»åŠ¡å‚æ•°ï¼ˆJSONï¼‰
- `result`: ä»»åŠ¡ç»“æœï¼ˆJSONï¼‰
- `error_message`: é”™è¯¯ä¿¡æ¯
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´
- `completed_at`: å®Œæˆæ—¶é—´

**params ç¤ºä¾‹**:
```json
{
  "prompt": "ç”Ÿæˆä¸€ä¸ªé›ªåœ°é‡Œçš„å†’é™©æ•…äº‹",
  "userImages": ["image_id1", "image_id2"],
  "sceneCount": 7,
  "characterCount": 2
}
```

**result ç¤ºä¾‹**:
```json
{
  "screenplayId": "uuid",
  "videoId": "uuid"
}
```

### 5. å‰§æœ¬è¡¨ (screenplays)

```sql
CREATE TABLE screenplays (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'confirmed', 'generating', 'completed', 'failed')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_screenplays_task_id ON screenplays(task_id);
CREATE INDEX idx_screenplays_user_id ON screenplays(user_id);
CREATE INDEX idx_screenplays_status ON screenplays(status);
```

**å­—æ®µè¯´æ˜**:
- `id`: å‰§æœ¬å”¯ä¸€æ ‡è¯†
- `task_id`: ä»»åŠ¡ IDï¼ˆå¤–é”®ï¼‰
- `user_id`: ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰
- `title`: å‰§æœ¬æ ‡é¢˜
- `status`: å‰§æœ¬çŠ¶æ€
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### 6. åœºæ™¯è¡¨ (scenes)

```sql
CREATE TABLE scenes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    screenplay_id UUID NOT NULL REFERENCES screenplays(id) ON DELETE CASCADE,
    scene_id INTEGER NOT NULL,
    narration TEXT NOT NULL,
    image_prompt TEXT NOT NULL,
    video_prompt TEXT NOT NULL,
    image_url TEXT,
    video_url TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'generating', 'completed', 'failed')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(screenplay_id, scene_id)
);

CREATE INDEX idx_scenes_screenplay_id ON scenes(screenplay_id);
CREATE INDEX idx_scenes_status ON scenes(status);
```

**å­—æ®µè¯´æ˜**:
- `id`: åœºæ™¯å”¯ä¸€æ ‡è¯†
- `screenplay_id`: å‰§æœ¬ IDï¼ˆå¤–é”®ï¼‰
- `scene_id`: åœºæ™¯åºå·ï¼ˆ1, 2, 3...ï¼‰
- `narration`: æ—ç™½æ–‡æœ¬
- `image_prompt`: å›¾ç‰‡ç”Ÿæˆæç¤ºè¯
- `video_prompt`: è§†é¢‘ç”Ÿæˆæç¤ºè¯
- `image_url`: ç”Ÿæˆçš„å›¾ç‰‡ URL
- `video_url`: ç”Ÿæˆçš„è§†é¢‘ URL
- `status`: åœºæ™¯çŠ¶æ€
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### 7. è§’è‰²è®¾å®šè¡¨ (character_sheets)

```sql
CREATE TABLE character_sheets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    screenplay_id UUID NOT NULL REFERENCES screenplays(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    combined_view_url TEXT,
    front_view_url TEXT,
    side_view_url TEXT,
    back_view_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_character_sheets_screenplay_id ON character_sheets(screenplay_id);
```

**å­—æ®µè¯´æ˜**:
- `id`: è§’è‰²å”¯ä¸€æ ‡è¯†
- `screenplay_id`: å‰§æœ¬ IDï¼ˆå¤–é”®ï¼‰
- `name`: è§’è‰²åç§°
- `description`: è§’è‰²æè¿°
- `combined_view_url`: ä¸‰è§†å›¾ç»„åˆå›¾ URL
- `front_view_url`: æ­£é¢å›¾ URL
- `side_view_url`: ä¾§é¢å›¾ URL
- `back_view_url`: èƒŒé¢å›¾ URL
- `created_at`: åˆ›å»ºæ—¶é—´

### 8. åª’ä½“æ–‡ä»¶è¡¨ (media_files)

```sql
CREATE TABLE media_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    type VARCHAR(20) NOT NULL CHECK (type IN ('image', 'video')),
    original_filename VARCHAR(255),
    storage_path TEXT NOT NULL,
    url TEXT NOT NULL,
    mime_type VARCHAR(100),
    size BIGINT,
    width INTEGER,
    height INTEGER,
    duration INTEGER,  -- è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_media_files_user_id ON media_files(user_id);
CREATE INDEX idx_media_files_type ON media_files(type);
CREATE INDEX idx_media_files_created ON media_files(created_at DESC);
```

**å­—æ®µè¯´æ˜**:
- `id`: åª’ä½“æ–‡ä»¶å”¯ä¸€æ ‡è¯†
- `user_id`: ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰
- `type`: æ–‡ä»¶ç±»å‹ï¼ˆimage/videoï¼‰
- `original_filename`: åŸå§‹æ–‡ä»¶å
- `storage_path`: å­˜å‚¨è·¯å¾„ï¼ˆMinIO/S3ï¼‰
- `url`: è®¿é—® URL
- `mime_type`: MIME ç±»å‹
- `size`: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
- `width`: å®½åº¦ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰
- `height`: é«˜åº¦ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰
- `duration`: æ—¶é•¿ï¼ˆè§†é¢‘ï¼Œç§’ï¼‰
- `metadata`: å…ƒæ•°æ®ï¼ˆJSONï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´

### 9. ä»»åŠ¡æ—¥å¿—è¡¨ (task_logs)

```sql
CREATE TABLE task_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    level VARCHAR(20) NOT NULL CHECK (level IN ('info', 'warning', 'error')),
    message TEXT NOT NULL,
    details JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_task_logs_task_id ON task_logs(task_id);
CREATE INDEX idx_task_logs_level ON task_logs(level);
CREATE INDEX idx_task_logs_created ON task_logs(created_at DESC);
```

**å­—æ®µè¯´æ˜**:
- `id`: æ—¥å¿—å”¯ä¸€æ ‡è¯†
- `task_id`: ä»»åŠ¡ IDï¼ˆå¤–é”®ï¼‰
- `level`: æ—¥å¿—çº§åˆ«
- `message`: æ—¥å¿—æ¶ˆæ¯
- `details`: è¯¦ç»†ä¿¡æ¯ï¼ˆJSONï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´

---

## ğŸ” ç´¢å¼•è®¾è®¡

### ä¸»é”®ç´¢å¼•
æ‰€æœ‰è¡¨çš„ä¸»é”®è‡ªåŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚

### å¤–é”®ç´¢å¼•
æ‰€æœ‰å¤–é”®å­—æ®µéƒ½åˆ›å»ºäº†ç´¢å¼•ï¼Œæé«˜ JOIN æŸ¥è¯¢æ€§èƒ½ã€‚

### å¤åˆç´¢å¼•
- `conversations(user_id, updated_at DESC)`: æŒ‰ç”¨æˆ·è·å–å¯¹è¯åˆ—è¡¨
- `conversations(user_id, is_pinned DESC, updated_at DESC)`: ç½®é¡¶å¯¹è¯ä¼˜å…ˆ
- `messages(conversation_id, created_at)`: æŒ‰å¯¹è¯è·å–æ¶ˆæ¯åˆ—è¡¨

### æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•
- `tasks(user_id, status)`: æŒ‰ç”¨æˆ·å’ŒçŠ¶æ€æŸ¥è¯¢ä»»åŠ¡
- `screenplays(user_id)`: æŒ‰ç”¨æˆ·æŸ¥è¯¢å‰§æœ¬
- `media_files(user_id, created_at DESC)`: æŒ‰ç”¨æˆ·å’Œæ—¶é—´æŸ¥è¯¢åª’ä½“æ–‡ä»¶

---

## ğŸ”— å…³ç³»å›¾

```
users
  â”œâ”€â”€ conversations (1:N)
  â”‚     â””â”€â”€ messages (1:N)
  â”œâ”€â”€ tasks (1:N)
  â”‚     â””â”€â”€ screenplays (1:1)
  â”‚           â”œâ”€â”€ scenes (1:N)
  â”‚           â””â”€â”€ character_sheets (1:N)
  â””â”€â”€ media_files (1:N)

tasks
  â””â”€â”€ task_logs (1:N)
```

### ER å›¾è¯´æ˜

1. **ç”¨æˆ· (users)** å¯ä»¥åˆ›å»ºå¤šä¸ª**å¯¹è¯ (conversations)**
2. **å¯¹è¯**åŒ…å«å¤šæ¡**æ¶ˆæ¯ (messages)**
3. **ç”¨æˆ·**å¯ä»¥åˆ›å»ºå¤šä¸ª**ä»»åŠ¡ (tasks)**
4. **ä»»åŠ¡**å…³è”ä¸€ä¸ª**å‰§æœ¬ (screenplays)**
5. **å‰§æœ¬**åŒ…å«å¤šä¸ª**åœºæ™¯ (scenes)** å’Œ**è§’è‰²è®¾å®š (character_sheets)**
6. **ç”¨æˆ·**å¯ä»¥ä¸Šä¼ å¤šä¸ª**åª’ä½“æ–‡ä»¶ (media_files)**
7. **ä»»åŠ¡**æœ‰å¤šä¸ª**ä»»åŠ¡æ—¥å¿— (task_logs)**

---

## ğŸ”„ æ•°æ®è¿ç§»

### ä»ç°æœ‰ Flutter åº”ç”¨è¿ç§»

#### 1. ç”¨æˆ·æ•°æ®è¿ç§»

```sql
-- ä»æœ¬åœ°å­˜å‚¨å¯¼å‡ºç”¨æˆ·æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
-- é¦–æ¬¡ç™»å½•æ—¶è‡ªåŠ¨åˆ›å»ºåç«¯è´¦æˆ·
```

#### 2. å¯¹è¯æ•°æ®è¿ç§»

```sql
-- å¯¼å‡º Hive æ•°æ®åº“ä¸­çš„å¯¹è¯æ•°æ®
-- é€šè¿‡ API æ‰¹é‡å¯¼å…¥
```

#### 3. æ¶ˆæ¯æ•°æ®è¿ç§»

```sql
-- å¯¼å‡º Hive æ•°æ®åº“ä¸­çš„æ¶ˆæ¯æ•°æ®
-- é€šè¿‡ API æ‰¹é‡å¯¼å…¥
```

### è¿ç§»è„šæœ¬ç¤ºä¾‹

```python
# migrate_from_hive.py
import json
from backend.services.conversation_service import ConversationService
from backend.services.message_service import MessageService

def migrate_conversations(hive_data_path):
    """ä» Hive æ•°æ®è¿ç§»å¯¹è¯å’Œæ¶ˆæ¯"""
    with open(hive_data_path, 'r') as f:
        data = json.load(f)
    
    for conv_data in data['conversations']:
        # åˆ›å»ºå¯¹è¯
        conversation = ConversationService.create({
            'userId': conv_data['userId'],
            'title': conv_data['title'],
            # ...
        })
        
        # å¯¼å…¥æ¶ˆæ¯
        for msg_data in conv_data['messages']:
            MessageService.create({
                'conversationId': conversation['id'],
                'role': msg_data['role'],
                'content': msg_data['content'],
                # ...
            })
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡æŸ¥è¯¢

### ç”¨æˆ·ç»Ÿè®¡

```sql
-- ç”¨æˆ·æ€»æ•°
SELECT COUNT(*) FROM users;

-- æ´»è·ƒç”¨æˆ·æ•°ï¼ˆæœ€è¿‘7å¤©ï¼‰
SELECT COUNT(DISTINCT user_id) 
FROM conversations 
WHERE last_accessed_at > NOW() - INTERVAL '7 days';
```

### ä»»åŠ¡ç»Ÿè®¡

```sql
-- ä»»åŠ¡å®Œæˆç‡
SELECT 
    status,
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage
FROM tasks
GROUP BY status;

-- å¹³å‡ä»»åŠ¡å¤„ç†æ—¶é—´
SELECT 
    AVG(EXTRACT(EPOCH FROM (completed_at - created_at))) as avg_duration_seconds
FROM tasks
WHERE status = 'completed' AND completed_at IS NOT NULL;
```

### åª’ä½“æ–‡ä»¶ç»Ÿè®¡

```sql
-- ç”¨æˆ·å­˜å‚¨ä½¿ç”¨é‡
SELECT 
    user_id,
    SUM(size) as total_size_bytes,
    COUNT(*) as file_count
FROM media_files
GROUP BY user_id
ORDER BY total_size_bytes DESC;
```

---

## ğŸ”’ æ•°æ®å®‰å…¨

### å¤‡ä»½ç­–ç•¥

1. **æ¯æ—¥å…¨é‡å¤‡ä»½**: ä½¿ç”¨ PostgreSQL çš„ `pg_dump`
2. **å®æ—¶å¢é‡å¤‡ä»½**: ä½¿ç”¨ WAL (Write-Ahead Logging)
3. **å¼‚åœ°å¤‡ä»½**: å®šæœŸåŒæ­¥åˆ°å¤‡ç”¨æœåŠ¡å™¨

### æ•°æ®æ¸…ç†

```sql
-- æ¸…ç†30å¤©å‰çš„ä»»åŠ¡æ—¥å¿—
DELETE FROM task_logs 
WHERE created_at < NOW() - INTERVAL '30 days';

-- æ¸…ç†å·²åˆ é™¤ç”¨æˆ·çš„åª’ä½“æ–‡ä»¶ï¼ˆé€šè¿‡è§¦å‘å™¨ï¼‰
```

### æ•°æ®åŠ å¯†

- **æ•æ„Ÿå­—æ®µ**: å¯†ç ä½¿ç”¨ bcrypt å“ˆå¸Œ
- **ä¼ è¾“åŠ å¯†**: ä½¿ç”¨ HTTPS/TLS
- **å­˜å‚¨åŠ å¯†**: æ•°æ®åº“è¿æ¥ä½¿ç”¨ SSL

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-12
