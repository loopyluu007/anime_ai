# âœ… æµ‹è¯•æ¡†æ¶æ­å»ºå®Œæˆ

## ğŸ“‹ å·²å®Œæˆçš„å·¥ä½œ

### 1. æµ‹è¯•æ¡†æ¶é…ç½® âœ…
- âœ… `pytest.ini` - pytesté…ç½®æ–‡ä»¶
- âœ… `requirements-test.txt` - æµ‹è¯•ä¾èµ–
- âœ… æµ‹è¯•ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ

### 2. æµ‹è¯•å·¥å…·å’ŒFixtures âœ…
- âœ… `conftest.py` - å…±äº«æµ‹è¯•fixtures
  - `db_session` - æµ‹è¯•æ•°æ®åº“ä¼šè¯
  - `client` - FastAPIæµ‹è¯•å®¢æˆ·ç«¯
  - `test_user_data` - æµ‹è¯•ç”¨æˆ·æ•°æ®
  - `test_user` - æµ‹è¯•ç”¨æˆ·å¯¹è±¡
  - `auth_headers` - è®¤è¯è¯·æ±‚å¤´

### 3. æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ âœ…
- âœ… `tests/unit/services/test_auth_service.py` - è®¤è¯æœåŠ¡å•å…ƒæµ‹è¯•
  - ç”¨æˆ·åˆ›å»ºæµ‹è¯•
  - é‡å¤é‚®ç®±/ç”¨æˆ·åæ£€æµ‹
  - ç”¨æˆ·æŸ¥è¯¢æµ‹è¯•
  - å¯†ç éªŒè¯æµ‹è¯•
  
- âœ… `tests/integration/api/test_auth_api.py` - è®¤è¯APIé›†æˆæµ‹è¯•
  - æ³¨å†ŒAPIæµ‹è¯•
  - ç™»å½•APIæµ‹è¯•
  - è·å–å½“å‰ç”¨æˆ·æµ‹è¯•
  - é”™è¯¯å¤„ç†æµ‹è¯•

### 4. æ–‡æ¡£ âœ…
- âœ… `tests/README.md` - æµ‹è¯•æ–‡æ¡£
- âœ… `tests/QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… `tests/.gitignore` - æµ‹è¯•æ–‡ä»¶å¿½ç•¥é…ç½®

### 5. æµ‹è¯•è„šæœ¬ âœ…
- âœ… `tests/run_tests.sh` - Linux/Macæµ‹è¯•è„šæœ¬
- âœ… `tests/run_tests.bat` - Windowsæµ‹è¯•è„šæœ¬

## ğŸ“Š æµ‹è¯•è¦†ç›–æƒ…å†µ

### å½“å‰è¦†ç›–
- âœ… è®¤è¯æœåŠ¡ (AuthService) - å•å…ƒæµ‹è¯•
- âœ… è®¤è¯API (Auth API) - é›†æˆæµ‹è¯•

### å¾…è¡¥å……æµ‹è¯•
- â³ å¯¹è¯æœåŠ¡ (ConversationService)
- â³ æ¶ˆæ¯æœåŠ¡ (MessageService)
- â³ ä»»åŠ¡æœåŠ¡ (TaskService)
- â³ å‰§æœ¬æœåŠ¡ (ScreenplayService)
- â³ åª’ä½“æœåŠ¡ (ImageService, VideoService)
- â³ API Gatewayä¸­é—´ä»¶æµ‹è¯•

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯ä»¥åšçš„ï¼š

1. **å®‰è£…æµ‹è¯•ä¾èµ–å¹¶è¿è¡Œæµ‹è¯•**
   ```bash
   cd backend
   pip install -r requirements-test.txt
   pytest
   ```

2. **æŸ¥çœ‹æµ‹è¯•ç»“æœå’Œè¦†ç›–ç‡**
   ```bash
   pytest --cov=services --cov=shared --cov-report=html
   ```

3. **è¡¥å……æ›´å¤šæµ‹è¯•ç”¨ä¾‹**
   - å‚è€ƒ `test_auth_service.py` ç¼–å†™å…¶ä»–æœåŠ¡çš„å•å…ƒæµ‹è¯•
   - å‚è€ƒ `test_auth_api.py` ç¼–å†™å…¶ä»–APIçš„é›†æˆæµ‹è¯•

### åç»­ä»»åŠ¡ï¼š

1. **è§£å†³æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜**ï¼ˆå¦‚é‡åˆ°ï¼‰
   - æ–¹æ¡ˆ1: ä½¿ç”¨PostgreSQLæµ‹è¯•æ•°æ®åº“
   - æ–¹æ¡ˆ2: ä½¿ç”¨æµ‹è¯•ä¸“ç”¨æ¨¡å‹ï¼ˆå·²åœ¨ `tests/utils/test_db_models.py` ä¸­å‡†å¤‡ï¼‰

2. **æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ° >80%**
   - è¡¥å……æ‰€æœ‰æ ¸å¿ƒæœåŠ¡çš„æµ‹è¯•
   - è¡¥å……æ‰€æœ‰APIç«¯ç‚¹çš„æµ‹è¯•

3. **æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•**
   - å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
   - è·¨æœåŠ¡é›†æˆæµ‹è¯•

## ğŸ“ æµ‹è¯•æ ‡è®°è¯´æ˜

ä½¿ç”¨pytestæ ‡è®°æ¥åˆ†ç±»æµ‹è¯•ï¼š

- `@pytest.mark.unit` - å•å…ƒæµ‹è¯•
- `@pytest.mark.integration` - é›†æˆæµ‹è¯•
- `@pytest.mark.api` - APIæµ‹è¯•
- `@pytest.mark.slow` - æ…¢é€Ÿæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

## ğŸ¯ æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- **å½“å‰**: ~20%ï¼ˆä»…è®¤è¯ç›¸å…³ï¼‰
- **ç›®æ ‡**: > 80%
- **æ£€æŸ¥å‘½ä»¤**: `pytest --cov-report=term-missing`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•README](./README.md) - è¯¦ç»†æµ‹è¯•æ–‡æ¡£
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICKSTART.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [FastAPIæµ‹è¯•æ–‡æ¡£](https://fastapi.tiangolo.com/tutorial/testing/)

---

**æ­å»ºå®Œæˆæ—¶é—´**: 2026-01-13  
**çŠ¶æ€**: âœ… æµ‹è¯•æ¡†æ¶å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ç¼–å†™æµ‹è¯•ç”¨ä¾‹
